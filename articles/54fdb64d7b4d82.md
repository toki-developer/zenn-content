---
title: "Expo(React Native)ã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œã‚‹ã¨ãã®ã‚ã‚Œã“ã‚Œ"
emoji: "âœ¨"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["reactnative", "expo", "swift", "ios"]
published: false
---

## æ¦‚è¦

å‹‰å¼·ç›®çš„ã§è‡ªåˆ†ãŒä½¿ã†ãŸã‚ã®ç¿’æ…£ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã¾ã—ãŸï¼
ãã®ä¸­ã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®é–‹ç™ºã‚’ã—ãŸã®ã§ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ä½¿ã„æ–¹ã‚’ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚

https://apps.apple.com/us/app/%E3%82%A6%E3%82%A3%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88%E3%81%A7%E7%BF%92%E6%85%A3/id6754188081

ä»Šå›åˆ©ç”¨ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚(ç¿’æ…£ã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚)
https://github.com/toki-developer/zenn-sample-expo-widget

## å‰æ

* iOSå›ºæœ‰ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã¯ã€åŸºæœ¬çš„ã«`/ios`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚
* ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’ã™ã¹ã¦è‡ªèº«ã§ç®¡ç†ã™ã‚‹ã®ã¯å¤§å¤‰ãªã®ã§ã€Expo CNGã§ã¯`/ios`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç›´æ¥ç·¨é›†ã—ã¾ã›ã‚“ã€‚
* `expo prebuild` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ã‚¢ãƒ—ãƒªæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«(`app.json`, `app.config.js`)ã®æƒ…å ±ã‚’å…ƒã« `/ios`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è‡ªå‹•æ›´æ–°ãƒ»ç”Ÿæˆã—ã¾ã™ã€‚
* `/ios`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯`expo prebuild`ã«ã‚ˆã£ã¦ä¸Šæ›¸ãã•ã‚Œã‚‹ãŸã‚ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’ç‹¬è‡ªã«è¨˜è¿°ã—ãŸã„å ´åˆã¯ã€åˆ¥ã®å ´æ‰€ã«ã‚³ãƒ¼ãƒ‰ã‚’é…ç½®ã—ã€ãƒªãƒ³ã‚¯ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã¨å‹•ä½œç¢ºèª

:::message
Xcodeã‚„iOS simulatorã®æº–å‚™ã¯å®Œäº†ã—ã¦ã„ã‚‹å‰æã§é€²ã‚ã¾ã™ã€‚
:::

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™
```
npx create-expo-app@latest zenn-widget-sample
```

ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç§»å‹•ã—ã¾ã™
```
cd zenn-widget-sample
```

ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™
```
npx expo prebuild -p ios
npm run ios
```

`npm run ios`å®Ÿè¡Œå¾Œã€iOS simulatorãŒè‡ªå‹•ã§ç«‹ã¡ä¸ŠãŒã‚‰ãªã„å ´åˆã¯ã€Œiã€ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
`npm run ios`ã‚’å®Ÿè¡Œã—ãŸã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ä»¥ä¸‹ã®è¡¨ç¤ºãŒã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚
> â€º Press i â”‚ open iOS simulator

ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã§ããŸã‚‰ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å°å…¥ã«é€²ã¿ã¾ã™ã€‚

:::details ã‚¢ãƒ—ãƒªèµ·å‹•ã®ã‚­ãƒ£ãƒ—ãƒãƒ£
![](https://storage.googleapis.com/zenn-user-upload/dbba31b5bccb-20251130.png)
:::

## ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å°å…¥

### åˆ©ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¤ã„ã¦
ç¾çŠ¶ã€Expoå…¬å¼ã§ã¯ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®é–‹ç™ºã®ã‚µãƒãƒ¼ãƒˆã‚’ã—ã¦ã„ãªã„ãŸã‚ã€Expo é–‹ç™ºè€…ã®Evan Bacon æ°ã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚ŒãŸ [expo-apple-targets](https://github.com/EvanBacon/expo-apple-targets) ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª(Expo Configãƒ—ãƒ©ã‚°ã‚¤ãƒ³)ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã¨`/targets/widget/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã€`/targets/widget/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ç·¨é›†ã®ã¿ã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å®Ÿè£…ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€`/ios`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã®ãƒªãƒ³ã‚¯è¨­å®šãŒè‡ªå‹•åŒ–ã•ã‚Œã¾ã™ã€‚

â€» å®Ÿé¨“çš„ãªæ©Ÿèƒ½ã§ã‚ã‚Šã€å°†æ¥çš„ã«ç ´å£Šçš„å¤‰æ›´ã®å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã€ã“ã‚Œã¯ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé–‹ç™ºã®ãŸã‚ã®Swiftãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ãªãã€Expoã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ãã®ãŸã‚ã€ã‚‚ã—åˆ¥ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãŒç™»å ´ã—ãŸå ´åˆã§ã‚‚ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ã‚³ãƒ¼ãƒ‰ï¼ˆSwiftï¼‰è‡ªä½“ã¯æ¯”è¼ƒçš„å®¹æ˜“ã«ç§»è¡Œã§ãã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã—ã¦å°å…¥ã™ã‚‹

[å…¬å¼ã®æ‰‹é †](https://github.com/EvanBacon/expo-apple-targets)ã«å¾“ã£ã¦ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å°å…¥ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚


:::details å…¬å¼ã®æ‰‹é †
![](https://storage.googleapis.com/zenn-user-upload/05d601bdf678-20251130.png)

ç¿»è¨³ (DeepL)
1. Expoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§npx create-targetã‚’å®Ÿè¡Œã—ã€Appleã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚
2. ç”Ÿæˆã™ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’é¸æŠã—ã¾ã™ã€‚ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼ˆä¾‹: npx create-target widgetï¼‰ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¿…è¦ãªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®/targetsã«ç”Ÿæˆã•ã‚Œã€@bacons/apple-targetsãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€Expo Configãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚
3. Apple Team IDãŒæ—¢ã«ãŠåˆ†ã‹ã‚Šã®å ´åˆã¯ã€app.jsonå†…ã®ios.appleTeamIdãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚Xcodeã®ã€Œç½²åã¨æ©Ÿèƒ½ã€ã‚¿ãƒ–ã§ç¢ºèªã§ãã€å¿…è¦ã«å¿œã˜ã¦å¾Œã‹ã‚‰è¨­å®šå¯èƒ½ã§ã™ã€‚
4. npx expo prebuild -p ios --clean ã‚’å®Ÿè¡Œã—ã¦Xcodeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚
5. Xcodeï¼ˆxed iosï¼‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãã€expo:targets/<target>ãƒ•ã‚©ãƒ«ãƒ€å†…ã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’é–‹ç™ºã§ãã¾ã™ã€‚
6. ãƒ“ãƒ«ãƒ‰æº–å‚™ãŒæ•´ã£ãŸã‚‰ã€Xcodeã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’é¸æŠã—ãƒ“ãƒ«ãƒ‰ã—ã¦ãã ã•ã„ã€‚
:::

ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦Appleã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚
```
npx create-target
```
ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’é¸æŠã™ã‚‹ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ŒWidgetã€ã‚’é¸æŠã—ã¾ã™ã€‚
ãƒã‚¤ãƒ†ã‚£ãƒ–ã«é–¢ã‚ã‚‹app.jsonã®æ›´æ–°ã‚’ã—ãŸã®ã§ã€prebuildã—ã¦ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ã€‚
```
npx expo prebuild -p ios --clean
npm run ios
```

iOS Simulatorã§ã‚¢ã‚¤ã‚³ãƒ³ã‚’é•·æŠ¼ã—ã™ã‚‹ã¨ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’é¸æŠå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
è©¦ã—ã«å·¦ã‹ã‚‰1ã¤ç›®ã‚’é¸æŠã™ã‚‹ã¨ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚
|ã‚¢ã‚¤ã‚³ãƒ³ã‚’é•·æŠ¼ã—|ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’è¡¨ç¤º|
|-|-|
|![](https://storage.googleapis.com/zenn-user-upload/993ad6b12cad-20251130.png)|![](https://storage.googleapis.com/zenn-user-upload/cb57f9595086-20251130.png)|

### ä¿®æ­£ã—ã¦å‹•ä½œç¢ºèª
Xcodeã‚’é–‹ãã¾ã™ã€‚
```
xed ios
```
![](https://storage.googleapis.com/zenn-user-upload/c7d01679614d-20251130.png)

`expo:targets/widget`ã®ä¸­ãŒä¿®æ­£ã™ã‚‹ç®‡æ‰€ã«ãªã‚Šã¾ã™ã€‚

è©¦ã—ã« `expo:targets/widget/widgets.swift`ã‚’ä¿®æ­£ã—ã¦ã¿ã¾ã™ã€‚
```diff swift:expo:targets/widget/widgets.swift
    var body: some View {
        VStack {
            Text("Time:")
            Text(entry.date, style: .time)

+            Text("Hello Widget")
-            Text("Favorite Emoji:")
-            Text(entry.configuration.favoriteEmoji)
        }
    }
```

Swiftãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ãŸãŸã‚ã€`npm run ios`ã§ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚
ä»Šå›ã¯app.jsonã‚’ä¿®æ­£ã—ã¦ã„ãªã„ã®ã§prebuildã¯ä¸è¦ã§ã™ã€‚
```
npm run ios
```

:::message
æ—¢ã«`npm run ios`ã‚’å®Ÿè¡Œä¸­ã®å ´åˆã€ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ã›ãšã«åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å†åº¦`npm run ios`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ãŒä¸è¦ãªãŸã‚ã€ãƒ“ãƒ«ãƒ‰æ™‚é–“ã‚’çŸ­ç¸®ã§ãã¾ã™ã€‚
:::

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/205ae14a762f-20251130.png)

ã“ã‚Œã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®é–‹ç™ºã‚’å§‹ã‚ã‚‹æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

## ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
### è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰
`npx create-target`ã«ã‚ˆã£ã¦è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚
ä»¥ä¸‹ã®5ã¤ã®Swiftãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã™ã€‚
* index.swift
  * ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
  * widgetã€WidgetControlã€WidgetLiveActivityã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹
  * æ–°ã—ã„ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œæˆã—ãŸå ´åˆã¯ã€ã“ã“ã«è¿½åŠ ã—ã¾ã™ã€‚
* WidgetControl.swift
  * ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚»ãƒ³ã‚¿ãƒ¼ãªã©ã«è¿½åŠ ã§ãã‚‹ã€ŒControlã€ã‚’æä¾›ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
  * ä»Šå›ã®è¨˜äº‹ã§ã¯å¯¾è±¡å¤–ã¨ã—ã¾ã™ï¼ˆæœªæ¤œè¨¼ï¼‰ã€‚
* WidgetLiveActivity.swift
  * ãƒ­ãƒƒã‚¯ç”»é¢ãªã©ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®æƒ…å ±ã‚’è¡¨ç¤ºã§ãã‚‹ã€ŒLive Activityã€ã‚’å®šç¾©ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
  * ä»Šå›ã®è¨˜äº‹ã§ã¯å¯¾è±¡å¤–ã¨ã—ã¾ã™ï¼ˆæœªæ¤œè¨¼ï¼‰ã€‚
* widget.swift
  * å…ˆã»ã©ç¢ºèªã—ãŸã‚ˆã†ãªé€šå¸¸ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆæ©Ÿèƒ½ç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«
  * ä»Šå›ã®è¨˜äº‹ã§ã¯ã€ã“ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’å¯¾è±¡ã¨ã—ã¾ã™ã€‚
* AppIntent.swift
  * ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®è¨­å®šç”¨ã®AppIntentã‚’å®šç¾©ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
  * ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šç”»é¢ã‹ã‚‰å€¤ã‚’è¨­å®šã§ãã‚‹


ä»Šå›ã¯é€šå¸¸ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®åˆ©ç”¨ã‚’æƒ³å®šã—ã¦ã„ã‚‹ã®ã§ã€`WidgetControl.swift` ã¨ `WidgetLiveActivity.swift` ã®ä¿®æ­£ã¯ä¸è¦ã§ã™ã€‚
`index.swift`ã‹ã‚‰ã‚‚è©²å½“ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```diff swift:expo:targets/widget/index.swift
@main
struct exportWidgets: WidgetBundle {
    var body: some Widget {
        // Export widgets here
        widget()
-        widgetControl()
-        WidgetLiveActivity()
    }
}
```

:::details ä½™è«‡:ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚»ãƒ³ã‚¿ãƒ¼ã‚’ç¢ºèª
`widgetControl`ã®å‘¼ã³å‡ºã—ã‚’æ¶ˆã™å‰ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚»ãƒ³ã‚¿ãƒ¼ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€æ¶ˆã™ã¨è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/051323302c55-20251130.png)
:::

### é€šå¸¸ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé–¢é€£ã®ã‚³ãƒ¼ãƒ‰
ä¸»ã«`AppIntent.swift`ã¨`widget.swift`ã‚’ä¿®æ­£ã—ã¦ã„ãã¾ã™ã€‚

#### AppIntent.swift
* WidgetConfigurationIntent
  * ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ç·¨é›†ç”»é¢ã‹ã‚‰è¨­å®šå¯èƒ½ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã©ã‚’å®šç¾©ã—ã¾ã™ã€‚
  * widget.swiftã‹ã‚‰åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

```diff swift:expo:targets/widget/AppIntent.swift
    @Parameter(title: "Favorite Emoji", default: "ğŸ˜ƒ")
    var favoriteEmoji: String
```

|ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’é•·æŠ¼ã—|ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ç·¨é›†ã‚’ã‚¿ãƒƒãƒ—|
|-|-|
|![](https://storage.googleapis.com/zenn-user-upload/20227c84e4b4-20251130.png)|![](https://storage.googleapis.com/zenn-user-upload/154cc1277581-20251130.png)|

#### widget.swift
* widget
  * `index.swift`ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹æœ€ä¸Šä½ã®æ§‹é€ ä½“ã‚’å®šç¾©ã—ã¾ã™ã€‚
* View (widgetEntryView)
  * ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®UIéƒ¨åˆ†
* Entry (SimpleEntry)
  * è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚„è¨­å®šå€¤ã‚’æŒã¤æ§‹é€ ä½“
* AppIntentTimelineProvider
  * placeholder
    * ãƒ‡ãƒ¼ã‚¿ãŒã¾ã å–å¾—ã§ããªã„å ´åˆãªã©ã«è¡¨ç¤ºã•ã‚Œã‚‹Entryã‚’å®šç¾©ã—ã¾ã™ã€‚
  * snapshot
    * ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¿½åŠ æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®Entryã‚’å®šç¾©ã—ã¾ã™ã€‚
  * timeline
    * ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å®šç¾©ã—ã¾ã™ï¼ˆä¾‹: 5åˆ†ã”ã¨ã€1æ™‚é–“ã”ã¨ãªã©ï¼‰ã€‚
    * å®Ÿéš›ã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚

è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚
https://qiita.com/yuuka_____gf/items/604c29a71584206f23d3

## ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹

ãƒ‡ãƒ¼ã‚¿å–å¾—ç”¨ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ã¾ã§ã®å®Ÿè£…ã‚’è¡Œã„ã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿å–å¾—ç”¨ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ

`expo:targets/widget/DataManager.swift`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```swift:expo:targets/widget/DataManager.swift
struct SampleModel: Identifiable {
  var id: String
  var name: String
}

class DataManager {
  static let shared = DataManager()
  
  func loadSampleData() -> [SampleModel] {
    var data = [
      SampleModel(id: "1", name: "hoge"),
      SampleModel(id: "2", name: "fuga")
    ]
    
    return data
  }
}
```

### ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹

`DataManager`ãŒè¿”å´ã™ã‚‹`SampleModel`ã®é…åˆ—ã‚’å—ã‘å–ã‚Šã€`SimpleEntry`ã«è¿½åŠ ã—ã¾ã™ã€‚
`View`ã§ã¯ã“ã®`SimpleEntry`ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ©ç”¨ã—ã¦è¡¨ç¤ºã—ã¾ã™ã€‚

æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯0æ™‚ã«ä¸€åº¦ã¨ã—ã¾ã—ãŸã€‚

```diff swift:expo:targets/widget/widget.swift
func placeholder(in context: Context) -> SimpleEntry {
-   SimpleEntry(date: Date(), configuration: ConfigurationAppIntent())
+   SimpleEntry(date: Date(), sampleList: [], configuration: ConfigurationAppIntent())
}

func snapshot(for configuration: ConfigurationAppIntent, in context: Context) async -> SimpleEntry {
-   SimpleEntry(date: Date(), configuration: ConfigurationAppIntent())
+   SimpleEntry(date: Date(), sampleList: [], configuration: ConfigurationAppIntent())
}
func timeline(for configuration: ConfigurationAppIntent, in context: Context) async -> Timeline<SimpleEntry> {
-    var entries: [SimpleEntry] = []
-
-    // Generate a timeline consisting of five entries an hour apart, starting from the current date.
-    let currentDate = Date()
-    for hourOffset in 0 ..< 5 {
-        let entryDate = Calendar.current.date(byAdding: .hour, value: hourOffset, to: currentDate)!
-        let entry = SimpleEntry(date: entryDate, configuration: configuration)
-        entries.append(entry)
-    }
-
-    return Timeline(entries: entries, policy: .atEnd)
+    let data = DataManager.shared.loadSampleData()
+    let entry = SimpleEntry(date: Date(), sampleList: data, configuration: configuration)
+
+    // 0æ™‚ã«æ›´æ–°
+    let calendar = Calendar.current
+    let now = Date()
+    let nextMidnight = calendar.nextDate(
+        after: now,
+        matching: DateComponents(hour: 0, minute: 0),
+        matchingPolicy: .nextTime
+    )!
+
+    return Timeline(entries: [entry], policy: .after(nextMidnight))
}

struct SimpleEntry: TimelineEntry {
    let date: Date
+   let sampleList: [SampleModel]
    let configuration: ConfigurationAppIntent
}

struct widgetEntryView : View {
    var entry: Provider.Entry

    var body: some View {
        VStack {
-           Text("Time:")
-           Text(entry.date, style: .time)
-
-           Text("Hello Widget")
+           ForEach(entry.sampleList, id: \.id) { sample in
+               Text(sample.name)
+           }
        }
    }
}
```

ä¿®æ­£å¾Œã€`npm run ios`ã‚³ãƒãƒ³ãƒ‰ã§ã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚
å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/dac1350d0fa9-20251130.png)

ã“ã“ã¾ã§å®Œäº†ã™ã‚Œã°ã€å®Ÿéš›ã«è¡¨ç¤ºã—ãŸã„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«`DataManager.swift`ã‚’ä¿®æ­£ã—ãŸã‚Šã€è¡¨ç¤ºã—ãŸã„ã‚ˆã†ã«`widget.swift`ã®`View`ã‚’ç·¨é›†ã™ã‚‹ã“ã¨ã§ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ãã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

## ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒ—ãƒªæœ¬ä½“ã¨å…±é€šåŒ–ã™ã‚‹

### å…±é€šåŒ–ã®æ¦‚è¦
ã‚¢ãƒ—ãƒªæœ¬ä½“ã¨Widgeté–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã—ãŸã„å ´åˆã«App GroupãŒã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚
App Groupã¯éš”é›¢ã•ã‚ŒãŸã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã‚’è¶…ãˆã¦å®‰å…¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚
ä»Šå›ã®è‡ªåˆ†ãŒä½œæˆã—ãŸã‚¢ãƒ—ãƒªã¯ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµã®ã‚¢ãƒ—ãƒªã§SQLiteã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ã„ã‚‹ã®ã§ã€ä»Šå›ã®ä¾‹ã§ã‚‚ã‚¢ãƒ—ãƒªæœ¬ä½“ã¨ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‹ã‚‰å…±æœ‰ã®SQLiteã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
ä»–ã«ã¯UserDefaultsãªã©ãŒã‚ˆãä½¿ã‚ã‚Œã‚‹ã¿ãŸã„ã§ã™ã€‚

### ã‚¢ãƒ—ãƒªæœ¬ä½“ã‹ã‚‰App Groupã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹


Expoå…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¾“ã£ã¦é€²ã‚ã¦ã„ãã¾ã™ã€‚

https://docs.expo.dev/versions/latest/sdk/sqlite/

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```
npx expo install expo-sqlite
```

SQLiteã‚’ä½¿ã†æº–å‚™ã‚’ã—ã¾ã™ã€‚
SQLiteProviderã®è¨­å®šã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆã¨åˆæœŸå€¤ã®è¨­å®šã‚’ã—ã¾ã™ã€‚
ä»Šå›ã¯ã‚µãƒ³ãƒ—ãƒ«ãªã®ã§å…¨ã¦_layout.tsxã«æ›¸ã„ã¦é€²ã‚ã¾ã™ã€‚

```diff tsx:app/_layout.tsx
+ import { SQLiteProvider, type SQLiteDatabase } from "expo-sqlite";
+ import { Paths } from "expo-file-system";

+ const APP_GROUP_ID = "group.com.toki-developer.zenn-widget-sample.widget";

export default function RootLayout() {
  const colorScheme = useColorScheme();

+  // App Groupã®ãƒ‘ã‚¹ã‚’å–å¾—
+  const dbDirectory = useMemo(() => {
+    return Paths.appleSharedContainers[APP_GROUP_ID]?.uri;
+  }, []);

  return (
    <ThemeProvider value={colorScheme === "dark" ? DarkTheme : DefaultTheme}>
+      <SQLiteProvider databaseName="database.db" directory={dbDirectory} onInit={migrateDbIfNeeded}>
        <Stack>
          <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
          <Stack.Screen
            name="modal"
            options={{ presentation: "modal", title: "Modal" }}
          />
        </Stack>
        <StatusBar style="auto" />
+      </SQLiteProvider>
    </ThemeProvider>
  );
}

+ async function migrateDbIfNeeded(db: SQLiteDatabase) {
+   const DATABASE_VERSION = 1;
+   let currentDbVersion;
+   let res = await db.getFirstAsync<{
+       user_version: number;
+   }>("PRAGMA user_version");
+   currentDbVersion = res ? res.user_version : 0;
+   if (currentDbVersion >= DATABASE_VERSION) {
+       return;
+   }
+   if (currentDbVersion === 0) {
+        // ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
+       await db.execAsync(`
+           CREATE TABLE sample (
+           id INTEGER PRIMARY KEY,
+           name TEXT NOT NULL
+       );
+       `);
+
+       // åˆæœŸãƒ‡ãƒ¼ã‚¿æŒ¿å…¥
+       await db.execAsync(`
+           INSERT INTO sample (id, name) VALUES
+           (1, 'hoge'),
+           (2, 'Hello Widget');
+       `);
+
+       currentDbVersion = 1;
+   }
+   await db.execAsync(`PRAGMA user_version = ${DATABASE_VERSION}`);
+}
```

SQLiteã‚’ä½¿ã†æº–å‚™ãŒå®Œäº†ã—ãŸã®ã§ã€Homeãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã¿ã¾ã™ã€‚

```diff tsx:app/(tabs)/index.tsx

export default function HomeScreen() {
+  const db = useSQLiteContext();

+  useEffect(() => {
+    async function fetchData() {
+      const results = await db.getAllAsync<{ id: number; name: string }>(
+        "SELECT * FROM sample"
+      );
+      console.log("Sample table data:", results);
+    }
+    fetchData();
+  }, [db]);

  return (
```

app.jsonãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã®ã§`npx expo prebuild -p ios --clean`ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ã€`npm run ios`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

:::message
ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ãŸæ™‚ã¯ã€èµ·å‹•ä¸­ã®`npm run ios`ã‚’æ­¢ã‚ã¦ã‹ã‚‰å†åº¦å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚
:::

ã‚¢ãƒ—ãƒªã‚’é–‹ã„ã¦ã€`npm run ios`ã‚’å®Ÿè¡Œã—ãŸã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã«è¡¨ç¤ºã•ã‚ŒãŸã‚‰æˆåŠŸã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/2c4346b8a5e2-20251201.png)

ã“ã‚Œã§ã€ã‚¢ãƒ—ãƒªæœ¬ä½“ã‹ã‚‰SQLiteã‚’ä½¿ã£ã¦App Groupã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã¾ã§å‡ºæ¥ã¾ã—ãŸã€‚

### ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‹ã‚‰App Groupã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‹ã‚‰App Groupã‚’ä½¿ã†ãŸã‚ã®è¨­å®šã‚’ã—ã¦ã„ãã¾ã™ã€‚
è¨­å®šã®è©³ç´°ã«ã¤ã„ã¦[expo-apple-targets](https://github.com/EvanBacon/expo-apple-targets)ã«ã„ã‚ã„ã‚ã¨è¨˜è¼‰ãŒã‚ã‚Šã¾ã™ã€‚

```diff json:app.json
    "ios": {
      "supportsTablet": true,
      "bundleIdentifier": "com.toki-developer.zenn-widget-sample",
+      "entitlements": {
+        "com.apple.security.application-groups": ["group.com.toki-developer.zenn-widget-sample.widget"]
+      }
    },
```
```diff js:targets/widget/expo-target.config.js
module.exports = config => ({
  type: "widget",
  icon: 'https://github.com/expo.png',
+  entitlements: {
+    "com.apple.security.application-groups":
+      config.ios.entitlements["com.apple.security.application-groups"],
+  },
});
```
â€» app.jsonã®å€¤ã‚’å‚ç…§ã—ã¦è¨­å®šã—ã¦ã„ã¾ã™ã€‚

App Groupã‚’å‚ç…§ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
```swift:targets/widget/DataManager.swift
import Foundation
import SQLite3

struct SampleModel: Identifiable {
  var id: String
  var name: String
}

class DataManager {
  static let shared = DataManager()
  
  func loadSampleData() -> [SampleModel] {
    guard let db = DatabaseManager.shared.openDatabase() else { return [] }
    defer { DatabaseManager.shared.closeDatabase() }
    
    return getSampleList(db: db)
  }
  
  private func getSampleList(db: OpaquePointer) -> [SampleModel] {
    var results: [SampleModel] = []
    let query = "SELECT id, name FROM sample;"
    var statement: OpaquePointer?

    if sqlite3_prepare_v2(db, query, -1, &statement, nil) == SQLITE_OK {
        while sqlite3_step(statement) == SQLITE_ROW {
            let id = String(cString: sqlite3_column_text(statement, 0))
            let name = String(cString: sqlite3_column_text(statement, 1))
            results.append(SampleModel(id: id, name: name))
        }
    }
    sqlite3_finalize(statement)
    
    return results
  }
}

class DatabaseManager {
    static let shared = DatabaseManager()
    
    let dbPath: String
    private var db: OpaquePointer?
    
    private init() {
        let appGroupId = "group.com.toki-developer.zenn-widget-sample.widget"

        guard let container = FileManager.default.containerURL(forSecurityApplicationGroupIdentifier: appGroupId) else {
            fatalError("App Groupè¨­å®šã‚¨ãƒ©ãƒ¼")
        }
        
        self.dbPath = container.appendingPathComponent("database.db").path
    }
    
    func openDatabase() -> OpaquePointer? {
        if !FileManager.default.fileExists(atPath: dbPath) {
            print("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“: \(dbPath)")
            return nil
        }
        
        if sqlite3_open(dbPath, &db) == SQLITE_OK {
            return db
        } else {
            print("SQLiteæ¥ç¶šã‚¨ãƒ©ãƒ¼: \(String(cString: sqlite3_errmsg(db)))")
            return nil
        }
    }
    
    func closeDatabase() {
        if db != nil {
            sqlite3_close(db)
            db = nil
        }
    }
}

```

`npx expo prebuild -p ios --clean` ã¨ `npm run ios`ã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã—ã¾ã™ã€‚

:::message
è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ä¸€åº¦Xcodeã¨iOS Simulatorã‚’çµ‚äº†ã—ãªã„ã¨ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãŒå‡ºæ¥ã¾ã›ã‚“ã§ã—ãŸã€‚
ã†ã¾ãã„ã‹ãªã„å ´åˆã¯è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
ãã‚Œã§ã‚‚ä¸Šæ‰‹ãã„ã‹ãªã„å ´åˆã¯ã€Xcodeã‹ã‚‰ã®ãƒ“ãƒ«ãƒ‰ã‚‚è©¦ã—ã¦ãã ã•ã„ã€‚
:::

ã‚¢ãƒ—ãƒªæœ¬ä½“å´ã§insertã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/a3e239c71a2b-20251201.png)

ã“ã‚Œã§ã‚¢ãƒ—ãƒªã¨ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§ãƒ‡ãƒ¼ã‚¿ã®å…±æœ‰ã‚’ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚

## ã‚¢ãƒ—ãƒªã‹ã‚‰ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’æ›´æ–°ã™ã‚‹

ç¶šã„ã¦ã€ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®æ›´æ–°ã‚’ã™ã‚‹ã«ã¯ã€[WidgetCenter](https://developer.apple.com/documentation/widgetkit/widgetcenter)ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

å…¨ã¦ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’æ›´æ–°ã™ã‚‹å ´åˆã¯`reloadAllTimelines`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
ç‰¹å®šã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã ã‘ã‚’æ›´æ–°ã—ãŸã„å ´åˆã¯`reloadTimelines`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```swift:.swift
WidgetCenter.shared.reloadAllTimelines()
WidgetCenter.shared.reloadTimelines(ofKind: "widget")
```

ã“ã®æ©Ÿèƒ½ã‚’React Nativeã‹ã‚‰åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã€[Expo Modules API](https://docs.expo.dev/modules/get-started/) ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚


ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
```
npx create-expo-module@latest --local widget-update
```

`/modules/widget-update/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œã‚‰ã‚Œã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/b5d207defbdd-20251201.png)

ã“ã“ã«Swiftã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦React Nativeã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚
éå»ã«ä½¿ã„æ–¹ã‚’æ›¸ã„ã¦ã„ã‚‹ã®ã§æ°—ã«ãªã£ãŸã‚‰å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
https://zenn.dev/toki_dev/articles/7362fab854aec3

ã¾ãšã¯ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆæ›´æ–°ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®é–¢æ•°ã‚’ä½œã‚Šã¾ã™ã€‚
`WidgetUpdateModule`ã®`definition`ã®ä¸­ã«`reloadTimelines`é–¢æ•°ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

```diff swift:modules/widget-update/ios/WidgetUpdateModule.swift
import ExpoModulesCore
+import WidgetKit

  public func definition() -> ModuleDefinition {
+    AsyncFunction("reloadTimelines") {
+      DispatchQueue.main.async {
+          WidgetCenter.shared.reloadAllTimelines()
+      }
+    }
  }
```

TypeScriptã®`WidgetUpdateModule`ã«ã‚‚`reloadTimelines`ã‚’å®£è¨€ã—ã¾ã™ã€‚

```diff ts:modules/widget-update/src/WidgetUpdateModule.ts
declare class WidgetUpdateModule extends NativeModule<WidgetUpdateModuleEvents> {
  PI: number;
  hello(): string;
  setValueAsync(value: string): Promise<void>;
+ reloadTimelines(): void;
}
```
`PI`ã€`hello`ãªã© `reloadTimelines`ä»¥å¤–ã®ã‚‚ã®ã¯æ¶ˆã—ã¦ã‚‚ã‹ã¾ã„ã¾ã›ã‚“ã€‚

ã‚ã¨ã¯ã€ã“ã‚Œã‚’React Nativeå´ã‹ã‚‰ä½¿ã†ã ã‘ã§ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã¨ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®æ›´æ–°ã‚’è¡Œã†ãƒœã‚¿ãƒ³ã‚’é…ç½®ã—ã¾ã™ã€‚
```diff tsx:app/(tabs)/index.tsx
import WidgetUpdateModule from "@/modules/widget-update/src/WidgetUpdateModule";

    <Button
        title="æ›´æ–°"
        onPress={async () => {
            await db.execAsync(
            `UPDATE sample SET name = 'Hello Zenn' WHERE id = 1`
            );
            WidgetUpdateModule.reloadTimelines();
        }}
    />
```

`npx expo prebuild -p ios --clean` ã¨ `npm run ios`ã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã—ã¾ã™ã€‚

ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‹ã‚‰ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’è¦‹ã‚‹ã¨ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸï¼
`WidgetUpdateModule.reloadTimelines`å®Ÿè¡Œã—ãªã„å ´åˆã«æ›´æ–°ã•ã‚Œãªã„ã“ã¨ã‚‚ç¢ºèªã—ã¦ãŠãã¨è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/3ec7082212f4-20251201.png)

ã“ã‚Œã§ã€ã‚¢ãƒ—ãƒªã‹ã‚‰ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ä»Šå›ã®è¨˜äº‹ã®å†…å®¹ã¯ã“ã“ã¾ã§ã§ã™ï¼ã“ã‚Œã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®é–‹ç™ºã¯é€²ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã¨æ€ã„ã¾ã™ï¼

èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

## ãŠã¾ã‘

### ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿æ›´æ–°
ä»Šå›ã®è¨˜äº‹ã§ã¯è©³ç´°ã¯æ›¸ãã¾ã›ã‚“ãŒã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```swift
struct ActionIntent: AppIntent {
    @Parameter(title: "ID")
    var id: String

    @MainActor
    func perform() async throws -> some IntentResult {
        // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãªã©ã®å‡¦ç†
        return .result()
    }
}
```

```swift:.swift
Button(intent: ActionIntent(id: id))
```

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’ã—ãŸæ™‚ã«ã‚¢ãƒ—ãƒªã®è¡¨ç¤ºã‚‚æ›´æ–°ã—ãŸã„å ´åˆã¯ã€ã‚¢ãƒ—ãƒªèµ·å‹•ã‚’æ¤œçŸ¥ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®å†å–å¾—ãªã©ã‚’ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

```ts:.ts
const subscription = AppState.addEventListener(
    "change",
    handleAppStateChange
);
```

### ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†

é–‹ç™ºã¨æœ¬ç•ªã§å¤‰æ•°ã‚’å¤‰ãˆãŸã„ãªã©ã€ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã„ãŸã„å ´åˆãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€`targets/widget/Info.plist`ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```swift:.swift
Bundle.main.object(forInfoDictionaryKey: "appGroupId")
```

```plist:targets/widget/Info.plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
  <dict>
    <key>NSExtension</key>
    <dict>
      <key>NSExtensionPointIdentifier</key>
      <string>com.apple.widgetkit-extension</string>
    </dict>
    <key>appGroupId</key>
    <string>group.com.toki-developer.zenn-widget-sample.widget</string>
  </dict>
</plist>
```

[ã“ã®Issue](https://github.com/EvanBacon/expo-apple-targets/issues/106#issuecomment-2738197338)ã«æŠ•ç¨¿ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ“ãƒ«ãƒ‰(`prebuild`)æ™‚ã«`Info.plist`ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

:::details ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚³ãƒ¼ãƒ‰
```js:plugins/withMultipleTargetInfoPlist/plugin.js
const { withDangerousMod } = require("@expo/config-plugins");
const fs = require("fs");
const path = require("path");
const plist = require("plist"); // Remember to install this module

const withMultipleTargetInfoPlist = (config, { targets }) => {
  return withDangerousMod(config, [
    "ios",
    (config) => {
      const projectRoot = config.modRequest.projectRoot;
      const iosDir = path.join(projectRoot, "targets");
      console.log("[ğŸ‘€ Customizing Info.plist] Targets directory:", iosDir);
      for (const { targetName, infoPlistUpdates } of targets) {
        const targetPath = path.join(iosDir, targetName, "Info.plist");
        console.log(
          "[ğŸ‘€ Customizing Info.plist] Found target:",
          targetName,
          "at",
          targetPath
        );
        if (fs.existsSync(targetPath)) {
          console.log(
            "[ğŸ¤– Customizing Info.plist] Matched target:",
            targetName,
            ", updating Info.plist"
          );
          const plistContent = fs.readFileSync(targetPath, "utf-8");
          const parsedPlist = plist.parse(plistContent);
          Object.assign(parsedPlist, infoPlistUpdates);
          const updatedPlistContent = plist.build(parsedPlist);
          fs.writeFileSync(targetPath, updatedPlistContent, "utf-8");
          console.log("[âœ… Customizing Info.plist] Plist updated");
        } else {
          console.log(
            "[ğŸŸ  Customizing Info.plist] Target path does not exist, skipping"
          );
        }
      }

      return config;
    },
  ]);
};

module.exports = withMultipleTargetInfoPlist;
```
:::

åŒã˜ãƒ‡ãƒã‚¤ã‚¹å†…ã§é–‹ç™ºã¨æœ¬ç•ªã§åˆ¥ã‚¢ãƒ—ãƒªã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å‚è€ƒã«ã™ã‚‹ã¨ã§ãã¾ã™ã€‚
https://docs.expo.dev/build-reference/variants/


## å‚è€ƒ

https://docs.expo.dev/workflow/continuous-native-generation
https://github.com/EvanBacon/expo-apple-targets
https://tech.fusic.co.jp/posts/expo-apple-widget/
https://qiita.com/yuuka_____gf/items/604c29a71584206f23d3
https://github.com/EvanBacon/expo-apple-targets/issues/106
https://docs.expo.dev/build-reference/variants/
https://zenn.dev/toki_dev/articles/7362fab854aec3
https://docs.expo.dev/versions/latest/sdk/sqlite/